<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MLB Records Since Sept 6, 2025 — Witch Era</title>
<meta name="description" content="Team records since Sept 6, 2025, sorted by win %, with a witchy vibe." />
<link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Creepster&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0a0712;
    --bg2:#120d1f;
    --card:#181127;
    --ink:#f1eaff;
    --muted:#bda9da;
    --accent:#9d77ff;
    --lime:#b6ff6a;
    --line:#2a1f3b;
    --glow:0 0 0 transparent,0 0 30px rgba(157,119,255,.25);
  }
  html,body{
    margin:0;
    background:
      radial-gradient(1200px 600px at 10% -10%, #1c1330 0%, transparent 60%),
      radial-gradient(1000px 600px at 90% 0%, #0f0b1c 0%, transparent 55%),
      linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
    color:var(--ink);
    font:16px/1.45 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }
  a{color:var(--accent);text-decoration:none}

  /* Floating moon + sparkles */
  .moon{
    position:fixed; right:4vw; top:4vh; width:90px; aspect-ratio:1;
    background:radial-gradient(circle at 30% 30%, #fff5d1 0%, #ffe7a3 35%, #f7d788 55%, #e0be66 70%, transparent 72%),
               radial-gradient(circle at 60% 70%, rgba(0,0,0,.15), transparent 35%);
    border-radius:50%; filter:drop-shadow(0 0 30px rgba(255,242,179,.2)); opacity:.5; pointer-events:none;
  }
  .sparkle{
    position:fixed; inset:0; background:
      radial-gradient(1px 1px at 12% 18%, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(1px 1px at 76% 8%, rgba(255,255,255,.25), transparent 60%),
      radial-gradient(1px 1px at 32% 44%, rgba(255,255,255,.25), transparent 60%),
      radial-gradient(1px 1px at 82% 56%, rgba(255,255,255,.18), transparent 60%),
      radial-gradient(1px 1px at 6% 74%, rgba(255,255,255,.22), transparent 60%),
      radial-gradient(1px 1px at 58% 84%, rgba(255,255,255,.3), transparent 60%);
    opacity:.5; pointer-events:none;
  }

  /* Header */
  header{max-width:1100px;margin:0 auto;padding:24px 24px 10px;}
  .topline{display:flex; align-items:center; gap:12px; flex-wrap:wrap;}
  .brand a{
    text-decoration:none;
    color:var(--ink);              /* readable on dark theme */
    font-weight:600;
    letter-spacing:.2px;
    font-family:'Abril Fatface', serif;
  }
  .brand a:hover{opacity:.8}

  /* Title divider implemented as a pseudo-element (no extra DOM node) */
  .title{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
  .title.with-sep{position:relative;margin-left:12px;padding-left:12px}
  .title.with-sep::before{
    content:"";position:absolute;left:0;top:50%;transform:translateY(-50%);
    width:1px;height:18px;background:#eaeaea;
  }
  @media (max-width:700px){
    .title.with-sep{margin-left:0;padding-left:0}
    .title.with-sep::before{display:none}
  }

  h1{margin:0;font-size:clamp(26px,5vw,40px);letter-spacing:.4px;text-shadow:var(--glow)}
  .creep{font-family:Creepster, system-ui; color:var(--lime); letter-spacing:.5px}
  .sub{color:var(--muted);font-size:14px;margin-top:6px}
  .controls{margin-top:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .pill{background:var(--card);border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:13px}
  .broom{height:16px;opacity:.9;filter:drop-shadow(0 0 12px rgba(157,119,255,.2));}

  /* Tweet screenshot slot */
  .tweet-wrap{max-width:1100px;margin:14px auto 0;padding:0 24px}
  .tweet{
    background:var(--card); border:1px solid var(--line); border-radius:16px; overflow:hidden;
    box-shadow:var(--glow)
  }
  .tweet img{display:block;width:100%;height:auto}

  /* Feature link */
  .feature{max-width:1100px;margin:14px auto 0;padding:0 24px}
  .feature .card{
    display:flex; gap:14px; align-items:center; background:linear-gradient(160deg,#1d1431,#20173a 60%, #241a42);
    border:1px solid var(--line); border-radius:14px; padding:12px 14px;
  }
  .feature .tag{font-family:Creepster; color:var(--lime); font-size:20px}
  .feature .desc{color:var(--muted); font-size:14px}
  .feature .cta{margin-left:auto; white-space:nowrap}
  .btn{
    display:inline-block; background:var(--accent); color:#0b0a13; font-weight:700;
    padding:8px 12px; border-radius:999px; border:0; transform:translateZ(0);
  }
  /* Mobile: make the feature compact */
  @media (max-width:600px){
    .feature{margin-top:6px}
    .feature .card{padding:8px 10px; gap:8px; background:var(--card); border-color:var(--line)}
    .feature .desc{display:none}
    .feature .cta .btn{padding:6px 10px; font-size:13px}
  }
  .feature .divider{
    height:1px;width:100%;
    background:linear-gradient(90deg,transparent,rgba(157,119,255,.35),transparent);
    margin:16px 0;
  }

  /* Single-column list of teams */
  main{max-width:760px;margin:16px auto 48px;padding:0 24px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}

  /* Card layout: fixed columns = rank | logo | meta (bars align from a fixed left edge) */
  .card{display:grid;grid-template-columns:32px 68px 1fr;column-gap:12px;background:var(--card);border:1px solid var(--line);border-radius:14px;padding:10px 12px}
  .rank{text-align:right;color:var(--muted);font-variant-numeric:tabular-nums}
  .logo{
    width:68px;height:44px;display:flex;align-items:center;justify-content:flex-start;
    background:transparent;border-radius:0;overflow:visible
  }
  .logo img{height:44px;width:auto;object-fit:contain}
  .meta{min-width:0}
  .team{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:700}
  .rec{color:var(--muted);font-variant-numeric:tabular-nums;font-size:13px}
  .wpct{font-variant-numeric:tabular-nums;font-weight:700}
  .bar{height:6px;background:#0f0a19;border-radius:999px;overflow:hidden;box-shadow:inset 0 0 8px rgba(157,119,255,.25)}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--lime), var(--accent));}

  footer{max-width:1100px;margin:24px auto 48px;padding:0 24px;color:var(--muted);font-size:12px}
  .error{color:#ff9aa8}
</style>
</head>
<body>
  <div class="moon" aria-hidden="true"></div>
  <div class="sparkle" aria-hidden="true"></div>

  <header>
    <div class="topline">
      <div class="brand"><a href="../index.html" rel="noopener" title="Ari Winkleman">Ari Winkleman</a></div>
      <div class="title with-sep">
        <img class="broom" alt="" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='64' height='16' viewBox='0 0 64 16'><g fill='%23b6ff6a'><rect x='0' y='6' width='44' height='4' rx='2'/><path d='M44 4h8l4 4-4 4h-8zM56 2l8 6-8 6z' opacity='.8'/></g></svg>">
        <h1><span class="creep">Witch Era</span> MLB Records Since Sept 6, 2025</h1>
      </div>
    </div>

    <div class="sub" id="rangeNote">Loading…</div>
    <div class="controls">
      <span class="pill">Window starts: <strong>2025-09-06</strong></span>
    </div>
  </header>

  <section class="tweet-wrap">
    <!-- Replace the src with your uploaded Twitter/X screenshot -->
    <figure class="tweet">
      <img src="images/mariners-tweet.png" alt="Tweet screenshot related to the Mariners' witch era" loading="lazy">
    </figure>
  </section>

  <section class="feature">
    <div class="card">
      <div class="tag" aria-hidden="true">✨ spell of the streak</div>
      <div class="desc">The Mariners’ fan who hired an Etsy witch, and the winning run that followed. A delightful read.</div>
      <div class="cta">
        <a class="btn" href="https://defector.com/the-seattle-mariners-are-in-their-etsy-witch-era" target="_blank" rel="noopener">Read the Defector piece</a>
      </div>
    </div>
    <div class="divider"></div>
  </section>

  <main>
    <section class="grid" id="grid" aria-live="polite"></section>
    <p id="err" class="error" style="display:none;"></p>
  </main>

  <footer>
    Results show each team’s record only from 2025-09-06 through today, sorted by win percentage. Data: MLB Stats API schedule endpoint. Logos via mlbstatic team logo assets.
  </footer>

<script>
(async function () {
  const START = '2025-09-06';

  // Local date as YYYY-MM-DD to avoid UTC off-by-one
  const now = new Date();
  const endLocal = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const END = [
    endLocal.getFullYear(),
    String(endLocal.getMonth() + 1).padStart(2, '0'),
    String(endLocal.getDate()).padStart(2, '0')
  ].join('-');

  const setNote = (txt) => { document.getElementById('rangeNote').textContent = txt; };
  setNote(`Through ${END} (Final games only)`);

  const showErr = (msg) => {
    const el = document.getElementById('err');
    el.style.display = '';
    el.textContent = msg;
  };

  // Final game detection works across schedule payload variants
  const isFinalGame = (status = {}) => {
    const coded = status.codedGameState || status.statusCode;
    const detail = (status.detailedState || '').toLowerCase();
    const abstract = (status.abstractGameState || '').toLowerCase();
    return coded === 'F' || detail === 'final' || abstract === 'final';
  };

  // Prefer linescore; fall back to teams.{home,away}.score
  const getScores = (g) => {
    const lsHome = g?.linescore?.teams?.home?.runs;
    const lsAway = g?.linescore?.teams?.away?.runs;
    const home = Number(lsHome ?? g?.teams?.home?.score ?? NaN);
    const away = Number(lsAway ?? g?.teams?.away?.score ?? NaN);
    return [home, away];
  };

  // Schedule URL
  const schedURL = `https://statsapi.mlb.com/api/v1/schedule?sportId=1&startDate=${START}&endDate=${END}&hydrate=team,linescore&gameTypes=R,P`;

  let data;
  try {
    const res = await fetch(schedURL, { cache: 'no-store' });
    if (!res.ok) throw new Error(`Schedule HTTP ${res.status}`);
    data = await res.json();
  } catch (e) {
    showErr(`Couldn't load MLB schedule: ${e.message}`);
    return;
  }

  const records = new Map(); // teamId -> { id, name, wins, losses }
  let countedGames = 0;

  const ensureTeam = (t) => {
    if (!records.has(t.id)) records.set(t.id, { id: t.id, name: t.name, wins: 0, losses: 0 });
    return records.get(t.id);
  };

  for (const d of (data?.dates ?? [])) {
    for (const g of (d?.games ?? [])) {
      if (!isFinalGame(g.status)) continue;

      const homeTeam = g?.teams?.home?.team;
      const awayTeam = g?.teams?.away?.team;
      if (!homeTeam || !awayTeam) continue;

      const [homeRuns, awayRuns] = getScores(g);
      if (!Number.isFinite(homeRuns) || !Number.isFinite(awayRuns)) continue;

      const H = ensureTeam({ id: homeTeam.id, name: homeTeam.name });
      const A = ensureTeam({ id: awayTeam.id, name: awayTeam.name });

      if (homeRuns > awayRuns) { H.wins++; A.losses++; }
      else if (awayRuns > homeRuns) { A.wins++; H.losses++; }

      countedGames++;
    }
  }

  document.getElementById('gameCount').textContent = String(countedGames);

  // Ensure all 30 teams render (0-0 if none in window)
  try {
    const teamsRes = await fetch('https://statsapi.mlb.com/api/v1/teams?sportId=1&activeStatus=Yes', { cache: 'no-store' });
    if (!teamsRes.ok) throw new Error(`Teams HTTP ${teamsRes.status}`);
    const teamsData = await teamsRes.json();
    for (const t of (teamsData?.teams ?? [])) {
      if (!records.has(t.id)) records.set(t.id, { id: t.id, name: t.name, wins: 0, losses: 0 });
    }
  } catch {
    // non-fatal
  }

  const rows = Array.from(records.values())
    .map(t => {
      const gp = t.wins + t.losses;
      const wpct = gp ? t.wins / gp : 0;
      return { ...t, gp, wpct };
    })
    .sort((a, b) => (b.wpct - a.wpct) || (b.wins - a.wins) || a.name.localeCompare(b.name));

  const grid = document.getElementById('grid');
  grid.innerHTML = '';

  const logoURL = (id) => `https://www.mlbstatic.com/team-logos/team-cap-on-light/${id}.svg`;

  let rank = 1;
  for (const r of rows) {
    const pct = (r.wpct * 100) || 0;
    const pctTxt = r.gp ? r.wpct.toFixed(3).replace(/^0/, '') : '.000';
    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <div class="rank">${rank}</div>
      <div class="logo"><img alt="${r.name} logo" loading="lazy" src="${logoURL(r.id)}" onerror="this.style.display='none'"/></div>
      <div class="meta">
        <div class="team">${r.name}</div>
        <div class="rec">${r.wins}-${r.losses} • <span class="wpct">${pctTxt}</span> • ${r.gp} G</div>
        <div class="bar" title="${pct.toFixed(1)}% win rate"><i style="width:${pct}%;"></i></div>
      </div>
    `;
    grid.appendChild(card);
    rank++;
  }

  if (!rows.length) {
    showErr('No teams to show. If you opened this from your filesystem, serve it over http://localhost to avoid fetch restrictions.');
  }
})();
</script>
</body>
</html>
