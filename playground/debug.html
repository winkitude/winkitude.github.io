<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Bruins Proxy Debug (Proxied Images)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:0;background:#0b1220;color:#e8eefc}
    .diag{background:#111b33;padding:16px 20px;border-bottom:1px solid #223;position:sticky;top:0;z-index:999}
    .diag h1{font-size:18px;margin:0 0 8px 0}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
    .card{background:#0f172a;border:1px solid #23304a;border-radius:10px;padding:10px;font-size:14px}
    .ok{color:#7ef7c7} .bad{color:#ff9887} .warn{color:#ffd27e}
    code{background:#152140;border:1px solid #27385e;border-radius:6px;padding:2px 6px}
    a{color:#9ec5ff}
    .log{white-space:pre-wrap;background:#0c1224;border:1px solid #223;border-radius:8px;padding:8px;margin-top:8px;max-height:180px;overflow:auto}
  </style>
</head>
<body>
  <div class="diag">
    <h1>Diagnostics (with proxied images)</h1>
    <div class="grid">
      <div class="card" id="c-proxy"><strong>Proxy Reachable:</strong> <span class="warn">testing…</span></div>
      <div class="card" id="c-landing"><strong>Landing Stats:</strong> <span class="warn">testing…</span></div>
      <div class="card" id="c-image"><strong>Headshot Image (proxied):</strong> <span class="warn">testing…</span></div>
    </div>
    <div class="log" id="log"></div>
  </div>
  <script>
    const PROXY = 'https://pederson-neely.ariswinkleman.workers.dev';
    const NHL_WEB = `${PROXY}/nhl-web`;
    const IMG = (id)=> `${PROXY}/img/headshots/current/168x168/${id}.jpg`;
    const log = (m)=>{const el=document.getElementById('log'); el.textContent += m + '\n'; console.log(m);};

    async function testProxy(){
      const el=document.getElementById('c-proxy');
      try{ 
        const r = await fetch(`${PROXY}/`);
        const j = await r.json();
        const ok = j?.ok === true;
        el.innerHTML = `<strong>Proxy Reachable:</strong> <span class="${ok?'ok':'bad'}">${ok?'OK':'FAILED'}</span>`;
        log('Proxy: '+ (ok?'OK':'FAILED'));
      }catch(e){ el.innerHTML=`<strong>Proxy Reachable:</strong> <span class="bad">FAILED</span>`; log('Proxy err '+e); }
    }
    async function testLanding(){
      const el=document.getElementById('c-landing');
      try{
        const r = await fetch(`${NHL_WEB}/v1/player/8449812/landing`); // Cam Neely
        const j = await r.json();
        const ok = Array.isArray(j?.seasons) && j.seasons.length>0;
        el.innerHTML = `<strong>Landing Stats:</strong> <span class="${ok?'ok':'bad'}">${ok?'OK':'FAILED'}</span>`;
        log('Landing: '+ (ok?'OK':'FAILED'));
      }catch(e){ el.innerHTML=`<strong>Landing Stats:</strong> <span class="bad">FAILED</span>`; log('Landing err '+e); }
    }
    async function testImage(){
      const el=document.getElementById('c-image');
      try{
        await new Promise((res,rej)=>{
          const img = new Image();
          img.onload=()=>res();
          img.onerror=(e)=>rej(e);
          img.src = IMG(8449812);
        });
        el.innerHTML = `<strong>Headshot Image (proxied):</strong> <span class="ok">OK</span>`;
        log('Image: OK');
      }catch(e){
        el.innerHTML = `<strong>Headshot Image (proxied):</strong> <span class="bad">FAILED</span>`;
        log('Image err '+e);
      }
    }
    (async ()=>{ await testProxy(); await testLanding(); await testImage(); })();
  </script>
</body>
</html>
