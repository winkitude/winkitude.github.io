<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Presidential &amp; Congressional Power — Rebuilt v4</title>
<style>
:root {
  --bg: #fff;
  --ink: #222;
  --rule: #e6e6e6;
  --muted: #f6f6f7;
  --colw: 260px;
  --portrait: 92px;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  background: var(--bg);
  color: var(--ink);
  font: 14px/1.3 Roboto, Helvetica, Arial;
}

/* === Global Layout === */
.power-page {
  display: flex;
  flex-direction: row;
  height: 100vh;
  overflow: hidden;
}

/* === Sidebar (Labels) === */
.labels {
  flex: 0 0 220px;
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
  background: white;
  border-right: 1px solid var(--rule);
  box-shadow: 8px 0 8px -8px rgba(0,0,0,0.08);
  padding: 12px;
  z-index: 10;
}

.labels-grid {
  display: grid;
  grid-template-rows: 10px 16px 75px 30px 28px 160px 50px 30px 190px 100px;
  gap: 6px;
}

.labels .cell {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  font-weight: 600;
}

/* Party key under Congressional Power */
.party-key-left {
  display: grid;
  grid-template-columns: 1fr;
  gap: 2px;
  margin-top: 4px;
  font-size: 11px;
  line-height: 1.1;
  font-weight:400;
}
.party-key-swatches {
  display: flex;
  flex-wrap: wrap;
  gap: 2px 6px; /* tighter horizontal/vertical gap */
  line-height: 1.1;
}
.party-key-swatches .sw {
  display: flex;
  align-items: center;
  gap: 4px;
}
.party-key-swatches i {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 2px;
}

/* === Timeline Wrapper === */
.timeline-wrapper {
  flex: 1;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
}

.timeline {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: var(--colw);
  height: 100%;
}

.col-grid {
  display: grid;
  grid-template-rows: 10px 16px 108px 45px 28px 160px 50px 230px 100px;
  border-right: 1px solid var(--rule);
  padding: 0 12px;
}

/* Portraits */
.portrait-row {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  gap: 12px;
  width: 100%;
  height: 100%;
}

.portrait-box {
  flex: 0 0 var(--portrait);
  width: var(--portrait);
  height: var(--portrait);
  border-radius: 8px;
  overflow: hidden;
  background: #f0f0f0;
}

.portrait-box img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.name { font-weight: 700; margin-top: -5px; }
.year { font-weight: 700; margin-top: -10px; }
.notes { font-size: 10px; line-height: 1.2; margin-top: 4px; color: #444; }

/* Chart bars */
.vbars {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: 1fr;
  gap: 2px;
  height: 64px; /* 80% of 80px */
  align-items: stretch;
  position: relative;
}
.vbars::before {
  content: "";
  position: absolute;
  left: 0; right: 0; top: 50%;
  height: 1px;
  background: #ddd;
}
.vbar {
  display: flex;
  flex-direction: column-reverse;
  height: 100%;
  justify-content: flex-end;
  position: relative;
  outline: 1px solid rgba(0,0,0,0.05);
}
.seg {
  width: 100%;
  min-height: 1px;
  border-radius: 0;
}
.seg + .seg {
  margin-top: 1px;
}
.pcttag {
  position: absolute;
  bottom: -14px;
  left: 50%;
  transform: translateX(-50%);
  white-space: nowrap;
  font: 700 10px/1 system-ui;
}

.mini-title {
  font: 600 11px/1 system-ui;
  color: #111;
  margin: 10px 0 4px; /* moved House section slightly down */
}

.congress-wrapper > div + div {
  margin-top: 30px; /* push the House group down */
}

/* Scrollbar styling */
.timeline-wrapper::-webkit-scrollbar {
  height: 12px;
}
.timeline-wrapper::-webkit-scrollbar-track {
  background: #f0f0f0;
}
.timeline-wrapper::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 6px;
}
.timeline-wrapper::-webkit-scrollbar-thumb:hover {
  background: #555;
}

.timeline-spacer {
  display: none;
}

/* === Mobile adjustments === */
@media (max-width: 768px) {
  
  
@media (max-width: 768px) {
  .power-page {
    display: grid;
    flex-direction: column;
    height: auto;
    overflow: visible;
    position: relative;
  }

  .labels {
    position: relative;
    flex: none;
    width: 100%;
    height: auto;
    z-index: 1;
    border-right: none;
    box-shadow: none;
      grid-column: 1 / 2;
    grid-row: 1;  
    transition: opacity 0.4s ease, transform 0.4s ease;
  will-change: transform, opacity;
  background: transparent !important; /* removes white box */
  }

  .timeline-wrapper {
    flex: 1;
  
    overflow-y: hidden;
    height: auto;
      grid-column: 2 / 3;
    grid-row: 1;
    overflow-x: auto;
    width: 100%;
   margin-left: 0; /* ensure timeline fills full width */
  }

  .timeline-spacer {
    display: block;
    width: var(--colw);
    min-width: var(--colw);
    background: transparent;
  }
}



}




/* === Overlay Sidebar System === */
.labels-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 220px;
  height: 100%;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
  padding: 1rem;
  overflow-y: auto;
  z-index: 1000;
  transition: transform 0.3s ease, opacity 0.3s ease;
}

.labels-overlay .labels-content {
  overflow-y: auto;
  height: 100%;
}

.labels-toggle {
  display: none;
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 1100;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  font-size: 1.2rem;
  cursor: pointer;
}

/* === Mobile Behavior === */
@media (max-width: 768px) {
  .labels-overlay {
    transform: translateX(-100%);
    opacity: 0;
    width: 70%;
  }

  .labels-overlay.active {
    transform: translateX(0);
    opacity: 1;
  }

  .labels-toggle {
    display: block;
  }
}


/* === Legend Spacer + Mobile Overlay Scroll Behavior === */
.timeline-spacer {
  width: var(--colw);
  min-width: var(--colw);
  background: transparent;
  grid-column: 1;
}

@media (max-width: 768px) {
  .timeline-spacer {
    display: block;
  }

  .labels-overlay {
    transform: translateX(-100%);
    opacity: 0;
    width: 70%;
    transition: transform 0.4s ease, opacity 0.4s ease;
  }

  .labels-overlay.active {
    transform: translateX(0);
    opacity: 1;
  }

  .labels-toggle {
    display: block;
  }
}


/* === Legend Overlay Behavior === */
.labels {
  position: fixed;
  top: 0;
  left: 0;
  width: 220px;
  height: 100vh;
  overflow-y: auto;
  background: #fff;
  box-shadow: 4px 0 10px rgba(0,0,0,0.08);
  border-right: 1px solid #ddd;
  z-index: 100;
  transition: transform 0.3s ease, opacity 0.3s ease;
}

/* Spacer before timeline to avoid overlap */
.timeline-spacer {
  width: 220px;
  min-width: 220px;
  background: transparent;
  flex-shrink: 0;
}

/* Mobile: sliding legend behavior */
@media (max-width: 768px) {
  .labels {
    transform: translateX(0);
    opacity: 1;
  }
  .labels.hidden {
    transform: translateX(-100%);
    opacity: 0;
  }
}
</style>
</head>
<body>
<main class="power-page">
<section class="timeline-wrapper">
<div class="timeline" id="timeline">
<div class="timeline-spacer"></div> <!-- ✅ Mobile-only spacer -->
<!-- existing timeline columns follow -->
</div>
</section>
</main>
<script>
(function(){
  const PARTY = {
    'Democratic': '#6a8cc3',
    'Jacksonian':'#6a8cc3',
    'Anti-Jackson': '#ff7f0e',
    'Republican': '#df6f5c',
    'Federalist': '#009444',
    'Democratic-Republican': '#92278f',
    'Whig': '#6f7b34',
    'National Republican': '#ff7f0e',
    'Pro-Administration': '#009444',
    'Anti-Administration': '#92278f',
    'Nullifier': '#72cbd7',
    'Anti-Masonic': '#f2e436',
    'Other': '#9aa0a6',
    'Populist': '#cc9dc8',
    'Progressive': '#a8d16e',
    'Dixiecrat': '#f4a261',
    'American Independent': '#e76f51'
  };

  const timeline = document.getElementById('timeline');

  fetch('presidential_data.json')
    .then(res => res.json())
    .then(DATA => {
      timeline.innerHTML = DATA.map(renderCol).join('');
    })
    .catch(err => console.error('Error loading data:', err));

  function renderCol(d){
    const color = PARTY[d.band] || '#ccc';
    const notes = (d.notes||[]).map(t=>`<li>${t}</li>`).join('');
    const congress = renderCongress(d);
    const presPower = d.presidentialPower || '';
    return `<article class="col"><div class="col-grid">
      <div class="pres-power">${presPower}</div>
      <div class="band" style="background:${color}"></div>
      <div class="portrait-row">${
        Array.isArray(d.portrait)
          ? d.portrait.map((p, i) => `<div class='portrait-box'><img src='${p}' alt='${d.name.split('/')[i] || d.name}'></div>`).join('')
          : `<div class='portrait-box'><img src='${d.portrait}' alt='${d.name}'></div>`
      }</div>
      <div class="name">${d.name}</div>
      <div class="year">${d.year}</div>
      <div class="map"><img src="${d.map}" alt="${d.year} map" style="width:100%; border-radius:6px;"></div>
      <div class="votes"><b>electoral</b> ${d.electoral}<br><b>popular</b> ${d.popular}</div>
      ${congress}
      <ul class="notes">${notes}</ul>
    </div></article>`;
  }

  function renderCongress(d){
    return `<div class="congress-wrapper">
      <div><div class="mini-title">Senate</div>${renderVBars(d.senateYears||[])}</div>
      <div><div class="mini-title">House</div>${renderVBars(d.houseYears||[])}</div>
    </div>`;
  }

  function renderVBars(years){
    // Normalize both flat and nested arrays
    if (!Array.isArray(years[0])) years = [years];

    return `<div class="vbars">${years.map(y=>{
      if (!Array.isArray(y)) return '';
      const maxSeg = y.reduce((a,b)=>b.pct > a.pct ? b : a, { pct: 0 });
      const segs = y.map(s=>{
        const color = PARTY[s.party] || '#999';
        const label = s === maxSeg ? `<span class="pcttag" style="color:${color}">${s.pct}%</span>` : '';
        return `<div class="seg" style="height:${s.pct}%; background:${color}" title="${s.party}: ${s.pct}%">${label}</div>`;
      }).join('');
      return `<div class="vbar">${segs}</div>`;
    }).join('')}</div>`;
  }
})();
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const timeline = document.querySelector(".timeline");
  const labels = document.querySelector(".labels");
  const wrapper = document.querySelector(".timeline-wrapper");

  // --- 1️⃣ Add a mobile-only blank spacer column before data ---
  if (timeline && timeline.innerHTML.trim() && !timeline.querySelector(".timeline-spacer")) {
    timeline.innerHTML = `
      <div class="timeline-spacer"></div>
      ${timeline.innerHTML}
    `;
  }

  // --- 2️⃣ Sidebar slide-away only on mobile ---
  if (labels && wrapper) {
    labels.style.transition = "opacity 0.4s ease, transform 0.4s ease";

    wrapper.addEventListener("scroll", () => {
      const isMobile = window.innerWidth <= 768;
      const scrollX = wrapper.scrollLeft;
      const slideStart = 120;
      const slideEnd = 250;

      if (!isMobile) {
        labels.style.transform = "translateX(0)";
        labels.style.opacity = "1";
        return;
      }

      if (scrollX < slideStart) {
        labels.style.transform = "translateX(0)";
        labels.style.opacity = "1";
      } else if (scrollX < slideEnd) {
        const progress = (scrollX - slideStart) / (slideEnd - slideStart);
        labels.style.transform = `translateX(${-progress * 100}%)`;
        labels.style.opacity = (1 - progress).toFixed(2);
      } else {
        labels.style.transform = "translateX(-100%)";
        labels.style.opacity = "0";
      }
    });
  }
});
</script>
<!-- === Overlay Sidebar System === -->
<aside class="labels-overlay">
<button class="labels-toggle">☰</button>
<div class="labels-content">
<aside class="labels">
<div class="labels-grid">
<div class="cell"><b>Presidential Power</b></div>
<div class="cell"><b>Party affiliation</b></div>
<div class="cell"><b>President</b></div>
<div class="cell"><b>Name</b></div>
<div class="cell"><b>Elected</b></div>
<div class="cell"><b>Electoral map</b></div>
<div class="cell"><b>Votes</b></div>
<div class="cell"><b>Congressional Power</b></div>
<div class="cell"> <div class="party-key-left">
<div class="party-key-swatches">
<span class="sw"><i style="background:#6a8cc3"></i>Democratic / Jacksonian</span>
<span class="sw"><i style="background:#ff7f0e"></i>Anti‑Jackson / National Republican</span>
<span class="sw"><i style="background:#df6f5c"></i>Republican</span>
<span class="sw"><i style="background:#009444"></i>Federalist / Pro‑Admin</span>
<span class="sw"><i style="background:#92278f"></i>Democratic‑Republican / Anti‑Admin</span>
<span class="sw"><i style="background:#6f7b34"></i>Whig</span>
<span class="sw"><i style="background:#72cbd7"></i>Nullifier</span>
<span class="sw"><i style="background:#f2e436"></i>Anti‑Masonic</span>
<!--<span class="sw"><i style="background:#cc9dc8"></i>Populist</span>-->
<span class="sw"><i style="background:#a8d16e"></i>Progressive</span>
<span class="sw"><i style="background:#f4a261"></i>Dixiecrat</span>
<!-- <span class="sw"><i style="background:#e76f51"></i>American Independent</span> -->
<span class="sw"><i style="background:#666666"></i>Independent</span>
</div>
</div>
</div>
<div class="cell"><b>Notes</b></div>
</div>
</aside>
</div>
</aside>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.querySelector(".labels-toggle");
  const overlay = document.querySelector(".labels-overlay");

  if (!toggle || !overlay) return;

  toggle.addEventListener("click", (e) => {
    e.stopPropagation();
    overlay.classList.toggle("active");
  });

  document.addEventListener("click", (e) => {
    if (window.innerWidth <= 768) {
      if (!overlay.contains(e.target) && !toggle.contains(e.target)) {
        overlay.classList.remove("active");
      }
    }
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const overlay = document.querySelector(".labels-overlay");
  const wrapper = document.querySelector(".timeline-wrapper");

  if (window.innerWidth <= 768 && overlay) {
    overlay.classList.add("active");

    if (wrapper) {
      let hasScrolled = false;
      wrapper.addEventListener("scroll", () => {
        if (!hasScrolled && wrapper.scrollLeft > 50) {
          overlay.classList.remove("active");
          hasScrolled = true;
        }
      }, { passive: true });
    }
  }
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const labels = document.querySelector(".labels");
  const wrapper = document.querySelector(".timeline-wrapper");
  const timeline = document.querySelector(".timeline");

  // 1️⃣ Add spacer to prevent timeline overlap
  if (timeline && !timeline.querySelector(".timeline-spacer")) {
    const spacer = document.createElement("div");
    spacer.className = "timeline-spacer";
    timeline.prepend(spacer);
  }

  // 2️⃣ Scroll detection fix for mobile
  if (!labels || !wrapper) return;

  let lastScrollLeft = 0;
  let ticking = false;
  let lastDirection = null;

  wrapper.addEventListener("scroll", () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        const currentScrollLeft = wrapper.scrollLeft;
        const isMobile = window.innerWidth <= 768;

        if (isMobile) {
          const direction = currentScrollLeft > lastScrollLeft ? "right" : "left";

          if (direction !== lastDirection) {
            if (direction === "right") {
              labels.classList.add("hidden");
            } else if (direction === "left") {
              labels.classList.remove("hidden");
            }
            lastDirection = direction;
          }
        }

        lastScrollLeft = currentScrollLeft <= 0 ? 0 : currentScrollLeft;
        ticking = false;
      });
      ticking = true;
    }
  });
});
</script>
</body>
</html>
